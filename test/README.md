# GheedBot Test Suite Hệ thống test toàn diện cho GheedBot Discord bot. ## Cấu trúc Test ``` test/ ├── README.md # Hướng dẫn này ├── test-runner.js # Test runner engine ├── run-all-tests.js # Chạy tất cả tests + tạo reports ├── test-commands.js # Test Discord commands ├── test-data-manager.js # Test data management system ├── test-file-structure.js # Test project structure ├── test-github-data.js # Test GitHub integration ├── test-permissions.js # Test permissions system ├── test-report.html # HTML report (auto-generated) └── test-report.json # JSON report (auto-generated) ``` ## Cách chạy Tests ### Chạy tất cả tests ```bash # Từ thư mục gốc của project cd test node run-all-tests.js # Hoặc từ thư mục gốc node test/run-all-tests.js ``` ### Chạy test cụ thể ```bash cd test node test-commands.js node test-data-manager.js node test-github-data.js ``` ### Chỉ test runner ```bash cd test node test-runner.js ``` ## Test Coverage ### 1. **File Structure Tests** (`test-file-structure.js`) - Project directory structure - Required files exist - JSON file validity - package.json structure - File permissions ### 2. **Commands Tests** (`test-commands.js`) - Command files exist - Export correct functions - Basic command logic - Mock interaction handling ### 3. **Data Manager Tests** (`test-data-manager.js`) - Local file loading - Data validation - GitHub configuration - Caching mechanism - Error handling ### 4. **GitHub Data Tests** (`test-github-data.js`) - Constructor và configuration - Repository settings - Cache operations - URL construction - HTTP request handling ### 5. **Permissions Tests** (`test-permissions.js`) - Permission functions exist - Config loading - Bypass permissions - Command validation - Role/channel checking ## Reports ### HTML Report - **File:** `test-report.html` - **Mô tả:** Visual report với charts và details - **Mở:** Double-click file hoặc mở trong browser ### JSON Report - **File:** `test-report.json` - **Mô tả:** Machine-readable report - **Sử dụng:** CI/CD, automation, parsing ## Test Configuration ### Environment Tests được thiết kế để chạy trong môi trường development: - Không cần Discord bot token - Không cần database connection - Sử dụng mock data và interactions ### Dependencies Tests sử dụng built-in Node.js modules: - `fs` - File system operations - `path` - Path utilities - `https` - HTTP requests - Không cần external test frameworks ## Test Results ### Success Indicators - **All tests passed:** Bot ready for production - **High success rate (>90%):** Generally good - ️ **Some warnings:** Non-critical issues ### Failure Indicators - **Failed tests:** Critical issues need fixing - **Crashed tests:** Serious problems - **Low success rate (<70%):** Major issues ## ️ Troubleshooting ### Common Issues #### "Config file not found" ```bash # Tạo config files cần thiết cp config/config.json.example config/config.json cp config/github-config.json.example config/github-config.json ``` #### "Data file not found" ```bash # Đảm bảo data files tồn tại ls data/ # Nên có: weapon.json, runeword.json, wiki.json ``` #### "Module not found" ```bash # Cài đặt dependencies npm install ``` #### "Permission denied" ```bash # Fix file permissions (Unix/Linux) chmod 644 config/*.json chmod 644 data/*.json ``` ### GitHub Integration Issues ```bash # Test GitHub URLs manually node test-github.js # Disable GitHub mode nếu cần # Sửa config/github-config.json: "enabled": false ``` ## CI/CD Integration ### Exit Codes - `0` - All tests passed - `1` - Some tests failed ### Example GitHub Actions ```yaml - name: Run Tests run: node test/run-all-tests.js - name: Upload Test Report uses: actions/upload-artifact@v2 with: name: test-report path: test/test-report.html ``` ## Adding New Tests ### 1. Create test file ```javascript // test/test-new-feature.js class NewFeatureTest { async runTests() { // Test implementation return { passed: 1, failed: 0, total: 1, details: [...] }; } } module.exports = { runTests: async () => { const test = new NewFeatureTest(); return await test.runTests(); } }; ``` ### 2. Test runner tự động detect Test runner sẽ tự động tìm và chạy file có pattern `test-*.js` ## Best Practices ### Test Design - **Independent:** Mỗi test không phụ thuộc vào test khác - **Fast:** Tests chạy nhanh, không có delays không cần thiết - **Reliable:** Kết quả consistent giữa các lần chạy - **Clear:** Error messages rõ ràng và hữu ích ### Mock Data - **Realistic:** Mock data giống real data - **Minimal:** Chỉ mock những gì cần thiết - **Safe:** Không ảnh hưởng production data ## Support Nếu có vấn đề với tests: 1. Kiểm tra console output để xem lỗi cụ thể 2. Xem test reports để hiểu chi tiết 3. Kiểm tra file structure và permissions 4. Đảm bảo tất cả dependencies đã được cài đặt